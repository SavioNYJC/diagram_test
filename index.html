<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Image Analyzer AI</h1>
        
        <form id="myForm">
            <div class="form-group">
                <label for="image"><i class="fas fa-image"></i> Upload Image</label>
                <div class="file-input-container">
                    <input type="file" name="image" id="image" accept="image/*" required>
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag your image here or click to browse</p>
                    <div class="file-upload-animation"></div>
                </div>
                <p class="file-name" id="fileName"></p>
            </div>

            <div class="form-group">
                <label for="prompt"><i class="fas fa-comment-alt"></i> What would you like to know?</label>
                <textarea name="prompt" id="prompt" placeholder="Ask something about the image (e.g., 'Explain what's happening in this chart')" required></textarea>
                <div class="focus-border"></div>
            </div>

            <button type="submit" id="submitBtn">
                <i class="fas fa-brain"></i> Analyze Image
            </button>
        </form>

        <div class="loading" id="loading"></div>

        <div id="result">
            <h2><i class="fas fa-lightbulb"></i> Analysis Results</h2>
            <p id="outputText"></p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('myForm');
        const imageInput = document.getElementById('image');
        const fileName = document.getElementById('fileName');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const outputText = document.getElementById('outputText');
        
        // Show file name when selected
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                fileName.textContent = this.files[0].name;
                
                // Preview image if needed
                // const reader = new FileReader();
                // reader.onload = function(e) {
                //     imagePreview.src = e.target.result;
                //     imagePreviewContainer.style.display = 'block';
                // }
                // reader.readAsDataURL(this.files[0]);
            }
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const formData = new FormData();
            formData.append("image", imageInput.files[0]);
            formData.append("prompt", document.getElementById("prompt").value);
            
            // Show loading animation
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            loading.style.display = 'block';
            result.classList.remove('active');
            form.classList.add('uploading');
            
            try {
                const response = await fetch("https://diagram-test.onrender.com/process", {
                    method: "POST",
                    body: formData,
                    mode: 'cors'
                });

                form.classList.remove('uploading');
                loading.style.display = 'none';
                
                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }

                const resultData = await response.json();
                
                // Display the result with animation
                outputText.textContent = resultData.response || `Received: ${resultData.message} - ${resultData.prompt}`;
                result.classList.add('active');
                result.classList.add('success');
                
                // Reset form state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-brain"></i> Analyze Image';
                
                // Scroll to result
                result.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                form.classList.remove('uploading');
                loading.style.display = 'none';
                outputText.textContent = `Error: ${error.message}`;
                result.classList.add('active');
                
                // Reset form state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-brain"></i> Try Again';
            }
        });
        
        // Add animation for textarea focus
        const textarea = document.querySelector('textarea');
        textarea.addEventListener('focus', function() {
            this.parentElement.querySelector('.focus-border').style.width = '100%';
        });
        
        textarea.addEventListener('blur', function() {
            this.parentElement.querySelector('.focus-border').style.width = '0';
        });
    });
    </script>
</body>
</html>