<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Image Analyzer AI</h1>
        
        <form id="myForm">
            <div class="form-group">
                <label for="image"><i class="fas fa-image"></i> Upload Image</label>
                <div class="file-input-container">
                    <input type="file" name="image" id="image" accept="image/*" required>
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag your image here or click to browse</p>
                    <div class="file-upload-animation"></div>
                </div>
                <p class="file-name" id="fileName"></p>
            </div>

            <div class="form-group">
                <label for="prompt"><i class="fas fa-comment-alt"></i> What would you like to know?</label>
                <textarea name="prompt" id="prompt" placeholder="Ask something about the image (e.g., 'Explain what's happening in this chart')" required></textarea>
                <div class="focus-border"></div>
            </div>

            <button type="submit" id="submitBtn">
                <i class="fas fa-brain"></i> Analyze Image
            </button>
        </form>

        <div class="loading" id="loading"></div>

        <div id="result">
            <h2><i class="fas fa-lightbulb"></i> Analysis Results</h2>
            <div class="result-metadata">
                <span class="result-label">Image:</span> <span id="resultFileName"></span>
            </div>
            <div class="result-content">
                <p id="outputText"></p>
            </div>
            <div class="result-actions">
                <button id="copyResults"><i class="fas fa-copy"></i> Copy</button>
                <button id="saveResults"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('myForm');
        const imageInput = document.getElementById('image');
        const fileName = document.getElementById('fileName');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const outputText = document.getElementById('outputText');
        const resultFileName = document.getElementById('resultFileName');
        const submitBtn = document.getElementById('submitBtn');
        
        // Initialize with empty results
        result.style.display = 'none';
        
        // Show file name when selected
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                fileName.textContent = this.files[0].name;
            }
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Animation for button click
            submitBtn.classList.add('clicking');
            setTimeout(() => {
                submitBtn.classList.remove('clicking');
            }, 400);

            // Validate form
            if (!imageInput.files || !imageInput.files[0]) {
                alert("Please select an image file");
                return;
            }

            const formData = new FormData();
            formData.append("image", imageInput.files[0]);
            formData.append("prompt", document.getElementById("prompt").value);
            
            // Show loading animation
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            loading.style.display = 'block';
            result.classList.remove('active');
            result.style.display = 'none';
            form.classList.add('uploading');
            
            try {
                const response = await fetch("https://diagram-test.onrender.com/process", {
                    method: "POST",
                    body: formData,
                    mode: 'cors'
                });

                form.classList.remove('uploading');
                loading.style.display = 'none';
                
                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }

                const resultData = await response.json();
                
                // Update the result file name
                resultFileName.textContent = imageInput.files[0].name;
                
                // Display the result with animation
                result.style.display = 'block';
                outputText.textContent = resultData.response || `Received: ${resultData.message} - ${resultData.prompt}`;
                result.classList.add('active');
                result.classList.add('success');
                animateText(outputText, resultData.response || `Received: ${resultData.message} - ${resultData.prompt}`);
                
                // Reset form state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-brain"></i> Analyze Image';
                
                // Scroll to result
                result.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                form.classList.remove('uploading');
                loading.style.display = 'none';
                result.style.display = 'block';
                outputText.textContent = `Error: ${error.message}`;
                result.classList.add('active');
                
                // Reset form state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-brain"></i> Try Again';
            }
        });
        
        // Add animation for textarea focus
        const textarea = document.querySelector('textarea');
        textarea.addEventListener('focus', function() {
            this.parentElement.querySelector('.focus-border').style.width = '100%';
        });
        
        textarea.addEventListener('blur', function() {
            this.parentElement.querySelector('.focus-border').style.width = '0';
        });

        // Copy results functionality
        document.getElementById('copyResults').addEventListener('click', function() {
            navigator.clipboard.writeText(outputText.textContent);
            this.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-copy"></i> Copy';
            }, 2000);
        });

        // Save results functionality
        document.getElementById('saveResults').addEventListener('click', function() {
            const blob = new Blob([outputText.textContent], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'analysis-results.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            this.innerHTML = '<i class="fas fa-check"></i> Saved!';
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-save"></i> Save';
            }, 2000);
        });
    });

    function animateText(element, text, speed = 30) {
        // Clear the element
        element.innerHTML = '';
        
        // Split text into lines/paragraphs
        const lines = text.split('\n');
        
        // Create span elements for each character in each line
        lines.forEach((line, lineIndex) => {
            // Create a paragraph element for each line
            const paragraph = document.createElement('p');
            paragraph.classList.add('line');
            
            // Split into characters and create spans
            line.split('').forEach(char => {
                const span = document.createElement('span');
                span.textContent = char;
                paragraph.appendChild(span);
            });
            
            // Add paragraph to the element
            element.appendChild(paragraph);
            
            // If not the last line and the line isn't empty, add a line break
            if (lineIndex < lines.length - 1 && line.trim() !== '') {
                element.appendChild(document.createElement('br'));
            }
        });
        
        // Add cursor element
        const cursor = document.createElement('span');
        cursor.classList.add('typing-cursor');
        element.appendChild(cursor);
        
        // Animation variables
        let lineIndex = 0;
        let charIndex = 0;
        const paragraphs = element.querySelectorAll('.line');
        
        // Function to type the next character
        function typeNextChar() {
            // If we've finished all lines
            if (lineIndex >= paragraphs.length) {
                cursor.remove(); // Remove cursor when done
                return;
            }
            
            const currentLine = paragraphs[lineIndex];
            const spans = currentLine.querySelectorAll('span');
            
            // If we've finished the current line
            if (charIndex >= spans.length) {
                lineIndex++;
                charIndex = 0;
                
                // Position cursor at beginning of next line
                if (lineIndex < paragraphs.length) {
                    const nextLine = paragraphs[lineIndex];
                    nextLine.parentNode.insertBefore(cursor, nextLine.nextSibling);
                    setTimeout(typeNextChar, speed * 3); // Slightly longer pause between lines
                }
                return;
            }
            
            // Make the next character visible
            spans[charIndex].classList.add('visible');
            
            // Position cursor after the character
            spans[charIndex].parentNode.insertBefore(cursor, spans[charIndex].nextSibling);
            
            // Move to next character
            charIndex++;
            
            // Schedule next character
            setTimeout(typeNextChar, speed);
        }
        
        // Start the animation
        setTimeout(typeNextChar, speed);
    }
    </script>
</body>
</html>